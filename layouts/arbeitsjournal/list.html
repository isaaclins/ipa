{{- /*
  Arbeitsjournal Section Layout
  
  Special layout for the work journal section.
  Automatically sorts entries by date (newest first).
  Displays a timeline view of all journal entries.
*/ -}}

{{ define "main" }}
<article class="arbeitsjournal-index">
  <header class="section-header">
    <h1>{{ .Title }}</h1>
    {{ with .Description }}
    <p class="section-description">{{ . }}</p>
    {{ end }}
  </header>
  
  {{ with .Content }}
  <div class="section-intro">
    {{ . }}
  </div>
  {{ end }}
  
  {{/* Calculate total working hours */}}
  {{- $totalHours := 0 -}}
  {{- range .Pages -}}
    {{- with .Params.arbeitszeit -}}
      {{- $hours := replaceRE "[^0-9]" "" . -}}
      {{- $totalHours = add $totalHours (int $hours) -}}
    {{- end -}}
  {{- end -}}
  
  <div class="journal-summary">
    <div class="summary-item">
      <span class="summary-label">Eintr√§ge:</span>
      <span class="summary-value">{{ len .Pages }}</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">Gesamtstunden:</span>
      <span class="summary-value">{{ $totalHours }}h</span>
    </div>
  </div>
  
  {{/* Timeline of journal entries, sorted by date descending */}}
  <div class="journal-timeline">
    {{ range .Pages.ByDate.Reverse }}
    <a href="{{ .Permalink }}" class="journal-entry">
      <div class="entry-date">
        <time datetime="{{ .Date.Format "2006-01-02" }}">
          <span class="day">{{ .Date.Format "02" }}</span>
          <span class="month">{{ .Date.Format "Jan" }}</span>
          <span class="year">{{ .Date.Format "2006" }}</span>
        </time>
      </div>
      <div class="entry-content">
        <h2>{{ .Title }}</h2>
        <div class="entry-meta">
          {{ with .Params.arbeitszeit }}
          <span class="arbeitszeit-badge">{{ . }}</span>
          {{ end }}
          {{- $done := findRE "- \\[x\\]" .RawContent -}}
          {{- if $done -}}
          <span class="tasks-done">{{ len $done }} Aufgaben erledigt</span>
          {{- end -}}
        </div>
      </div>
    </a>
    {{ end }}
  </div>
</article>
{{ end }}
