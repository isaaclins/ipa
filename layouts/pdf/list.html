{{- /* PDF Layout - Full Document for Browser Print This layout combines ALL
content into a single printable HTML document. Use browser's File > Print
(Ctrl+P / Cmd+P) to save as PDF. Features: - Mermaid diagrams render before
print - Print button waits for all content to load - Images fully supported
Structure: 1. Titelblatt (Title Page) 2. Table of Contents 3. All Parts/Chapters
(numbered) 4. Arbeitsjournal 5. Verzeichnisse (Abbildungsverzeichnis, Glossar,
Quellenverzeichnis) */ -}}

<!DOCTYPE html>
<html lang='{{ .Site.LanguageCode | default "de-ch" }}'>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {{/* Doc3.1: Chrome's built-in "Headers and footers" uses
    <title>
      for the center text. This puts the candidate name in every page's header
      automatically. */}} <title>IPA Dokumentation â€“ {{ .Site.Params.autor }}
    </title>
    <link rel="stylesheet" href="{{ "css/main.css" | absURL }}"> <link
    rel="stylesheet" href="{{ "css/pdf.css" | absURL }}"> {{/* Mermaid is loaded
    by the diagram shortcode via window.__mermaidPromise */}}

    <style>
      /* Page footer â€” uses Hugo template variables */

      /* First page - no header */
      @page :first {
        @top-center {
          content: none;
        }
        @bottom-center {
          content: none;
        }
        @bottom-right {
          content: none;
        }
        @bottom-left {
          content: none;
        }
      }

      /* Title pages - no page numbers */
      @page title {
        @top-center {
          content: none;
        }
        @bottom-center {
          content: none;
        }
      }

      @page {
        size: A4;
        margin: 2.5cm 2cm;

        /* Running headers/footers */
        @top-center {
          content: string(chapter-title);
          font-family: monospace;
          font-size: 10pt;
          color: #595959;
        }

        @bottom-left {
          content: "\00a9  {{ .Site.Params.autor }}, All rights reserved";
          font-family: monospace;
          font-size: 9pt;
          color: #595959;
        }
        @bottom-right {
          content: "IPA {{ .Site.Params.autor }}";
          font-family: monospace;
          font-size: 9pt;
          color: #595959;
        }

        @bottom-center {
          content: counter(page);
          font-family: monospace;
          font-size: 10pt;
        }
      }

      /* Print button - hidden when printing */
      .print-controls {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .print-btn {
        background: #000000;
        color: white;
        border: none;
        padding: 12px 24px;
        font-family: monospace;
        font-size: 16px;
        font-weight: 600;
        border-radius: 0;
        cursor: pointer;
        box-shadow: none;
        border: 1px solid #000000;
        transition: all 0.2s;
      }

      .print-btn:hover {
        background: #595959;
        border-color: #595959;
      }

      .print-btn:disabled {
        background: #595959;
        border-color: #595959;
        cursor: wait;
      }

      .print-status {
        background: white;
        padding: 8px 16px;
        border-radius: 0;
        font-family: monospace;
        font-size: 14px;
        border: 1px solid #000000;
      }

      @media print {
        .print-controls {
          display: none !important;
        }
      }
    </style>
  </head>
  <body class="pdf-document">
    {{/* Print Controls */}}
    <div class="print-controls">
      <span class="print-status" id="printStatus"
        >Diagramme werden geladen...</span
      >
      <button class="print-btn" id="printBtn" disabled onclick="window.print()">
        ðŸ“„ Als PDF speichern
      </button>
    </div>

    {{/* ========== TITELBLATT ========== */}}
    <section id="titelblatt" class="titelblatt pdf-section">
      <div class="titelblatt-content">
        <div class="titelblatt-title">
          <h1 class="ipa-title">
            {{ .Site.Params.thema | default .Site.Title }}
          </h1>
        </div>
        <div class="titelblatt-subtitle">
          <h1 class="document-type">{{ .Site.Params.description }}</h1>
        </div>
        <div class="titelblatt-meta">
          <table class="meta-table">
            <tr>
              <th>Autor:</th>
              <td>{{ .Site.Params.autor }}</td>
            </tr>
            <tr>
              <th>Firma:</th>
              <td>{{ .Site.Params.firma }}</td>
            </tr>
            <tr>
              <th>Abteilung:</th>
              <td>{{ .Site.Params.abteilung }}</td>
            </tr>
            <tr>
              <th>Berufsschule:</th>
              <td>{{ .Site.Params.berufsschule }}</td>
            </tr>
            <tr>
              <th>Validexperte (VEX):</th>
              <td>{{ .Site.Params.validexperte }}</td>
            </tr>
            <tr>
              <th>Hauptexperte (HEX):</th>
              <td>{{ .Site.Params.hauptexperte }}</td>
            </tr>
            <tr>
              <th>Nebenexperte (NEX):</th>
              <td>{{ .Site.Params.nebenexperte }}</td>
            </tr>
            <tr>
              <th>Verantwortliche Fachkraft (VF):</th>
              <td>{{ .Site.Params.verantwortlicheFachkraft }}</td>
            </tr>
            <tr>
              <th>Berufsbildner:</th>
              <td>{{ .Site.Params.berufsbildner }}</td>
            </tr>
            <tr>
              <th>Fachrichtung:</th>
              <td>{{ .Site.Params.fachrichtung }}</td>
            </tr>
            <tr>
              <th>Projektvorgehensmodell:</th>
              <td>{{ .Site.Params.projektvorgehensmodell }}</td>
            </tr>
            <tr>
              <th>Jahrgang und Kanton:</th>
              <td>{{ .Site.Params.jahrgangKanton }}</td>
            </tr>
            <tr>
              <th>Ausgabedatum:</th>
              <td>{{ .Site.Params.ausgabedatum }}</td>
            </tr>
            <tr>
              <th>Datum:</th>
              <td>{{ .Site.Params.datumVon }} - {{ .Site.Params.datumBis }}</td>
            </tr>
            <tr>
              <th>Version:</th>
              <td>{{ .Site.Params.version }}</td>
            </tr>
          </table>
        </div>
      </div>
    </section>

    {{/* ========== TABLE OF CONTENTS ========== */}}
    <section id="toc" class="toc pdf-section">
      <h1>Inhaltsverzeichnis</h1>
      <nav class="toc-content">
        {{- $chapterNum := 0 -}} {{- range .Site.Sections -}} {{- if and (not
        (eq .Section "pdf")) (not (eq .Section "glossar")) (not (eq .Section
        "arbeitsjournal")) -}} {{- $chapterNum = add $chapterNum 1 -}}
        <div class="toc-chapter">
          <a href="#{{ .Section }}" class="toc-chapter-link">
            <span class="toc-num">{{ $chapterNum }}.</span>
            <span class="toc-title">{{ .Title }}</span>
          </a>
          {{- if .Pages -}}
          <ul class="toc-subchapters">
            {{- range $subNum, $page := .Pages.ByWeight -}}
            <li>
              <a href="#{{ $page.File.ContentBaseName }}">
                <span class="toc-num"
                  >{{ $chapterNum }}.{{ add $subNum 1 }}</span
                >
                <span class="toc-title">{{ $page.Title }}</span>
              </a>
            </li>
            {{- end -}}
          </ul>
          {{- end -}}
        </div>
        {{- end -}} {{- end -}} {{/* Arbeitsjournal in TOC */}} {{- with
        .Site.GetPage "/arbeitsjournal" -}}
        <div class="toc-chapter">
          <a href="#arbeitsjournal" class="toc-chapter-link">
            <span class="toc-title">Arbeitsjournal</span>
          </a>
        </div>
        {{- end -}} {{/* Verzeichnisse in TOC */}}
        <div class="toc-chapter">
          <a href="#verzeichnisse" class="toc-chapter-link">
            <span class="toc-title">Verzeichnisse</span>
          </a>
          <ul class="toc-subchapters">
            <li>
              <a href="#abbildungsverzeichnis">
                <span class="toc-title">Abbildungsverzeichnis</span>
              </a>
            </li>
            {{- with .Site.GetPage "/glossar" -}}
            <li>
              <a href="#glossar">
                <span class="toc-title">Glossar</span>
              </a>
            </li>
            {{- end -}} {{- if $.Site.Data.quellen -}}
            <li>
              <a href="#quellenverzeichnis">
                <span class="toc-title">Quellenverzeichnis</span>
              </a>
            </li>
            {{- end -}}
          </ul>
        </div>
      </nav>
    </section>

    {{/* ========== MAIN CONTENT - ALL PARTS ========== */}} {{- $chapterNum :=
    0 -}} {{- range .Site.Sections -}} {{- if and (not (eq .Section "pdf")) (not
    (eq .Section "glossar")) (not (eq .Section "arbeitsjournal")) -}} {{-
    $chapterNum = add $chapterNum 1 -}} {{/* Chapter Title Page */}}
    <section id="{{ .Section }}" class="chapter pdf-section">
      <div class="chapter-title-page">
        <div class="chapter-number">
          <span class="chapter-label">Kapitel</span>
          <span class="chapter-num">{{ $chapterNum }}</span>
        </div>
        <h1 class="chapter-title">{{ .Title }}</h1>
        {{ with .Description }}
        <p class="chapter-description">{{ . }}</p>
        {{ end }}
      </div>

      {{ with .Content }}
      <div class="chapter-intro">{{ . }}</div>
      {{ end }}
    </section>

    {{/* Subchapters */}} {{- range $subNum, $page := .Pages.ByWeight -}}
    <section
      id="{{ $page.File.ContentBaseName }}"
      class="subchapter pdf-section"
    >
      <header class="subchapter-header">
        <div class="subchapter-number">
          {{ $chapterNum }}.{{ add $subNum 1 }}
        </div>
        <h2 class="subchapter-title">{{ $page.Title }}</h2>
      </header>
      <div class="subchapter-content">{{ $page.Content }}</div>
    </section>
    {{- end -}} {{- end -}} {{- end -}} {{/* ========== ARBEITSJOURNAL
    ========== */}} {{- with .Site.GetPage "/arbeitsjournal" -}} {{/* Title page
    - standalone */}}
    <section id="arbeitsjournal" class="arbeitsjournal pdf-section">
      <div class="chapter-title-page">
        <h1 class="chapter-title">{{ .Title }}</h1>
      </div>
    </section>

    {{/* Content starts on next page */}}
    <section class="arbeitsjournal-content pdf-section">
      {{ with .Content }}
      <div class="section-intro">{{ . }}</div>
      {{ end }} {{/* Journal entries sorted by date */}} {{- range .Pages.ByDate
      -}}
      <article class="journal-entry pdf-subsection">
        <header class="journal-header">
          <h3>{{ .Title }}</h3>
          <div class="journal-meta">
            <time>{{ .Date.Format "02.01.2006" }}</time>
            {{ with .Params.arbeitszeit }}
            <span class="arbeitszeit">{{ . }}</span>
            {{ end }}
          </div>
        </header>
        <div class="journal-content">{{ .Content }}</div>
      </article>
      {{- end -}}
    </section>
    {{- end -}} {{/* ========== VERZEICHNISSE ========== */}} {{/* Title page
    */}}
    <section id="verzeichnisse" class="verzeichnisse pdf-section">
      <div class="chapter-title-page">
        <h1 class="chapter-title">Verzeichnisse</h1>
      </div>
    </section>

    {{/* --- Abbildungsverzeichnis --- */}}
    <section
      id="abbildungsverzeichnis"
      class="verzeichnis-subsection pdf-section"
    >
      <h2 class="verzeichnis-title">Abbildungsverzeichnis</h2>
      <div
        class="abbildungsverzeichnis-content"
        id="abbildungsverzeichnisContent"
      >
        {{/* Populated by JavaScript - scans all figures and diagrams in the
        document */}}
        <p class="verzeichnis-empty" id="abbildungsverzeichnisEmpty">
          Keine Abbildungen vorhanden.
        </p>
      </div>
    </section>

    {{/* --- Glossar --- */}} {{- with .Site.GetPage "/glossar" -}}
    <section id="glossar" class="verzeichnis-subsection pdf-section">
      <h2 class="verzeichnis-title">Glossar</h2>
      <div class="glossar-content">
        {{- range $key, $value := sort $.Site.Data.glossary "term" -}}
        <div class="glossar-entry" id="glossar-{{ $value.id | urlize }}">
          <dt class="glossar-term">{{ $value.term }}</dt>
          <dd class="glossar-definition">{{ $value.definition }}</dd>
        </div>
        {{- end -}}
      </div>
    </section>
    {{- end -}} {{/* --- Quellenverzeichnis --- */}} {{- if .Site.Data.quellen
    -}}
    <section id="quellenverzeichnis" class="verzeichnis-subsection pdf-section">
      <h2 class="verzeichnis-title">Quellenverzeichnis</h2>
      <div class="quellenverzeichnis-content">
        <ol class="quellen-list">
          {{- range sort .Site.Data.quellen "titel" -}}
          <li class="quellen-entry" id="quelle-{{ .id | urlize }}">
            <span class="quellen-text">
              {{- with .autor }}{{ . }}{{ end -}} {{- with .jahr }} ({{ . }}){{
              end -}} {{- with .titel }}. <em>{{ . }}</em>{{ end -}} {{- with
              .verlag }}. {{ . }}{{ end -}} {{- with .url }}.
              <a href="{{ . }}">{{ . }}</a>{{ end -}} {{- with .zugriff }}
              [Zugriff: {{ . }}]{{ end -}}
            </span>
          </li>
          {{- end -}}
        </ol>
      </div>
    </section>
    {{- end -}} {{/* ========== MERMAID INITIALIZATION & PRINT READY ==========
    */}}
    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const printBtn = document.getElementById("printBtn");
        const printStatus = document.getElementById("printStatus");

        // Rewrite glossary links to internal PDF anchors
        // The shortcode generates absolute URLs like http://.../glossar/#glossar-api
        // but in the PDF all content is on one page, so we use #glossar-api directly
        document.querySelectorAll("a.glossary-link").forEach(function (link) {
          const href = link.getAttribute("href");
          const hashIndex = href.indexOf("#glossar-");
          if (hashIndex !== -1) {
            link.setAttribute("href", href.substring(hashIndex));
          }
        });

        // Auto-generate Abbildungsverzeichnis from figures and diagrams in the document
        (function () {
          const container = document.getElementById(
            "abbildungsverzeichnisContent"
          );
          const emptyMsg = document.getElementById(
            "abbildungsverzeichnisEmpty"
          );
          if (!container) return;

          const figures = document.querySelectorAll(
            "figure.figure, figure.diagram"
          );
          if (figures.length === 0) return;

          // Hide empty message and build list
          if (emptyMsg) emptyMsg.style.display = "none";

          const list = document.createElement("ol");
          list.className = "abbildungsverzeichnis-list";

          figures.forEach(function (fig) {
            const figcaption = fig.querySelector("figcaption");
            if (!figcaption) return;

            const label = fig.querySelector(".figure-label, .diagram-label");
            const caption = fig.querySelector(
              ".figure-caption, .diagram-caption"
            );
            const id = fig.id;

            const li = document.createElement("li");
            li.className = "abbildungsverzeichnis-entry";

            const link = document.createElement("a");
            link.href = "#" + id;
            link.textContent =
              (label ? label.textContent : "") +
              " " +
              (caption ? caption.textContent : "");
            li.appendChild(link);

            list.appendChild(li);
          });

          container.appendChild(list);
        })();

        try {
          // Wait for Mermaid diagrams (loaded by the diagram shortcode)
          if (window.__mermaidPromise) {
            const diagrams = document.querySelectorAll(".mermaid");
            printStatus.textContent = `Rendere ${diagrams.length} Diagramm(e)...`;
            await window.__mermaidPromise;
          }

          // Wait for all images to load
          const images = document.querySelectorAll("img");
          if (images.length > 0) {
            printStatus.textContent = `Lade ${images.length} Bild(er)...`;
            await Promise.all(
              Array.from(images)
                .filter((img) => !img.complete)
                .map(
                  (img) =>
                    new Promise((resolve) => {
                      img.onload = resolve;
                      img.onerror = resolve;
                    })
                )
            );
          }

          // All ready
          printStatus.textContent = "âœ“ Bereit zum Drucken";
          printStatus.style.background = "#dae5ec";
          printBtn.disabled = false;
        } catch (error) {
          console.error("Rendering error:", error);
          printStatus.textContent = "âš  Fehler - trotzdem drucken mÃ¶glich";
          printStatus.style.background = "#dae5ec";
          printBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
