{{- /*
  Section Layout - Chapter and Section List Pages
  
  Handles both chapter title pages (_index.md) and section listings.
  Supports automatic chapter numbering via section index.
  Detects 'chapter: true' in front matter for chapter title pages.
*/ -}}

{{ define "main" }}
{{- $sectionIndex := 0 -}}
{{- range $i, $section := .Site.Sections -}}
  {{- if eq $section.File.Dir $.File.Dir -}}
    {{- $sectionIndex = add $i 1 -}}
  {{- end -}}
{{- end -}}

<article class="section-page">
  {{- if .Params.chapter -}}
  {{/* Chapter Title Page */}}
  <div class="chapter-title-page">
    <div class="chapter-number">
      <span class="chapter-label">Kapitel</span>
      <span class="chapter-num">{{ $sectionIndex }}</span>
    </div>
    <h1 class="chapter-title">{{ .Title }}</h1>
    {{ with .Description }}
    <p class="chapter-description">{{ . }}</p>
    {{ end }}
  </div>
  {{- else -}}
  {{/* Regular Section Page */}}
  <header class="section-header">
    <h1>{{ .Title }}</h1>
    {{ with .Description }}
    <p class="section-description">{{ . }}</p>
    {{ end }}
  </header>
  {{- end -}}
  
  {{ with .Content }}
  <div class="section-content">
    {{ . }}
  </div>
  {{ end }}
  
  {{/* List child pages */}}
  {{ if .Pages }}
  <nav class="section-toc">
    <h2>In diesem Kapitel</h2>
    <ol class="chapter-list">
      {{- range .Pages.ByWeight -}}
      <li>
        <a href="{{ .Permalink }}">
          <span class="page-title">{{ .Title }}</span>
          {{ with .Description }}
          <span class="page-description">{{ . }}</span>
          {{ end }}
        </a>
      </li>
      {{- end -}}
    </ol>
  </nav>
  {{ end }}
</article>
{{ end }}
